}
# 绘制联合基因的ROC曲线
plot(combined_roc_curve,
col = "blue",
main = "ROC Curve for Combined Gene Expression",
xlab = "False positive rate",
ylab = "True positive rate",
lwd = 2,
xlim = c(0, 1), # 确保x轴从0到1
ylim = c(0, 1)) # 确保y轴从0到1
abline(a = 0, b = 1, lty = 2, col = "gray")
text(0.8, 0.2, labels = paste("AUC =", round(auc(combined_roc_curve), 2)), col = "blue")
# 分别绘制 top_genes 的 ROC 曲线
par(mfrow = c(2, 3))  # 创建一个2x3的绘图布局
for (gene in top_genes) {
single_roc_curve <- roc(group, data[[gene]], levels = c("class0", "class1"), direction = "<")
plot(single_roc_curve,
main = paste("ROC Curve for", gene),
xlab = "False positive rate",
ylab = "True positive rate",
lwd = 2,
col = "blue",
xlim = c(0, 1), # 确保x轴从0到1
ylim = c(0, 1)) # 确保y轴从0到1
abline(a = 0, b = 1, lty = 2, col = "gray")
text(0.8, 0.2, labels = paste("AUC =", round(auc(single_roc_curve), 2)), col = "blue")
}
library(pROC)
library(dplyr)
library(ggplot2)
library(caret)
#pdf("ROC3.pdf",width = 5,height = 5)
# 假设 wide_data 和 final_significant_genes_lihc 已经存在
# 创建数据框
data <- wide_data[, final_significant_genes_lihc, drop = FALSE]
data$group <- wide_data$group
# 移除 group 为 "CRC" 的行
data <- subset(data, data$group != "CRC")
# 替换 group 列的值
data <- data %>%
mutate(group = ifelse(group == "LIHC", 0, ifelse(group == "CRLM", 1, group)))
# 将 group 列转换为因子类型，并更改标签为有效的R变量名
data$group <- factor(data$group, levels = c(0, 1), labels = c("class0", "class1"))
# 提取 group 列
group <- data$group
# 初始化存储 AUC 值的数据框
auc_results <- data.frame(Gene = character(), AUC = numeric(), stringsAsFactors = FALSE)
# 计算每个基因的 AUC 值
for (gene in setdiff(names(data), "group")) {
roc_curve <- roc(group, data[[gene]])
auc_value <- auc(roc_curve)
auc_results <- rbind(auc_results, data.frame(Gene = gene, AUC = auc_value))
}
# 查看 AUC 结果
print(auc_results)
# 按 AUC 降序排序并选择前 5 个基因
auc_results <- auc_results[order(auc_results$AUC, decreasing = TRUE), ]
top_genes <- auc_results[1:5, "Gene"]
# 查看选择的基因
print(top_genes)
# 构建数据框，只包含选择的基因和 group 列
selected_data <- data[, c(top_genes, "group")]
# 设置交叉验证参数
control <- trainControl(method = "cv", number = 10, classProbs = TRUE, summaryFunction = twoClassSummary)
# 使用交叉验证训练模型
cv_model <- train(group ~ ., data = selected_data, method = "glm", family = binomial, trControl = control, metric = "ROC")
# 查看交叉验证结果
print(cv_model)
# 提取预测概率
predicted_probabilities <- predict(cv_model, selected_data, type = "prob")[,2]
# 计算联合基因的ROC曲线
combined_roc_curve <- roc(selected_data$group, predicted_probabilities, levels = c("class0", "class1"), direction = "<")
# 绘制联合基因的ROC曲线
plot(combined_roc_curve,
col = "blue",
main = "ROC Curve for Combined Gene Expression",
xlab = "1 - Specificity (False Positive Rate)",  # x轴为1-特异性
ylab = "Sensitivity (True Positive Rate)",   # y轴为敏感性
lwd = 2,
xlim = c(0, 1), # 确保x轴从0到1
ylim = c(0, 1)) # 确保y轴从0到1
abline(a = 0, b = 1, lty = 2, col = "gray")
text(0.8, 0.2, labels = paste("AUC =", round(auc(combined_roc_curve), 2)), col = "blue")
# 分别绘制 top_genes 的 ROC 曲线
par(mfrow = c(2, 3))  # 创建一个2x3的绘图布局
for (gene in top_genes) {
single_roc_curve <- roc(group, data[[gene]], levels = c("class0", "class1"), direction = "<")
plot(single_roc_curve,
main = paste("ROC Curve for", gene),
xlab = "1 - Specificity (False Positive Rate)",  # x轴为1-特异性
ylab = "Sensitivity (True Positive Rate)",   # y轴为敏感性
lwd = 2,
col = "blue",
xlim = c(0, 1), # 确保x轴从0到1
ylim = c(0, 1)) # 确保y轴从0到1
abline(a = 0, b = 1, lty = 2, col = "gray")
text(0.8, 0.2, labels = paste("AUC =", round(auc(single_roc_curve), 2)), col = "blue")
#dev.off()
}
#################火山图
pdf("IGP_sig_胶原蛋白protein_sum.pdf",width = 9,height = 5)
library(tidyverse)
library(ggrepel)
gc()
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
gc()
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
library(shiny); runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
runApp('D:/BiologicalCodeinR/proteomeExpert-proteomeExpert/FFPE_glycopeptides/appchange.R')
runApp('D:/BiologicalCodeinR/proteomeExpert-proteomeExpert/app-糖组糖肽.R')
runApp('D:/BiologicalCodeinR/proteomeExpert-proteomeExpert/app-糖组糖肽.R')
runApp('D:/BiologicalCodeinR/proteomeExpert-proteomeExpert/app-糖组糖肽.R')
runApp('appchange.R')
runApp('appchange.R')
library(shiny); runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
HSP_12.5ug = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
HSP_25ug = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
HSP_50ug = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
HSP_100ug = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +          # 画折线
geom_point(size = 3) +         # 添加数据点
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +             # 简洁主题
scale_x_continuous(breaks = c(24, 48, 72)) # 确保X轴显示所有时间点
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
HSP_12.5ug/ml = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Cell Viability%, color = HSP_Concentration, group = HSP_Concentration)) +
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
HSP_12.5ug/ml = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Cell Viability%, color = HSP_Concentration, group = HSP_Concentration)) +
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Cell Viability, color = HSP_Concentration, group = HSP_Concentration)) +
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Cell_Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +          # 画折线
geom_point(size = 3) +         # 添加数据点
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +             # 简洁主题
scale_x_continuous(breaks = c(24, 48, 72)) # 确保X轴显示所有时间点
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +          # 画折线
geom_point(size = 3) +         # 添加数据点
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Cell Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +             # 简洁主题
scale_x_continuous(breaks = c(24, 48, 72)) # 确保X轴显示所有时间点
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +          # 画折线
geom_point(size = 3) +         # 添加数据点
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Cell Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +             # 简洁主题
scale_x_continuous(breaks = c(24, 48, 72)) + # 确保X轴显示所有时间点
# 自定义图例标签
scale_color_discrete(labels = c("12.5 μg/ml", "25 μg/ml", "50 μg/ml", "100 μg/ml"))
# 加载必要的包
library(ggplot2)
library(tidyr)
# 数据
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )
)
# 长格式转换并处理标签
data_long <- pivot_longer(
data,
cols = -Time,
names_to = c("Prefix", "Concentration"),
names_pattern = "HSP_([0-9.]+)ug/ml",
values_to = "Viability"
) %>%
mutate(HSP_Concentration = paste0(Prefix, "_", Concentration, " μg/ml"))
# 绘图
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +
geom_point(size = 3) +
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Cell Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +
scale_x_continuous(breaks = c(24, 48, 72))
# 加载必要的包（只需要 tidyr 和 ggplot2）
library(ggplot2)
library(tidyr)
# 数据
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )
)
# 长格式转换
data_long <- pivot_longer(
data,
cols = -Time,
names_to = c("Prefix", "Concentration"),
names_pattern = "HSP_([0-9.]+)ug/ml",
values_to = "Viability"
)
# 用基础 R 语法添加新列
data_long$HSP_Concentration <- paste0(data_long$Prefix, "_", data_long$Concentration, " μg/ml")
# 绘图代码保持不变
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +
geom_point(size = 3) +
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Cell Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +
scale_x_continuous(breaks = c(24, 48, 72))
# 加载必要的包
library(ggplot2)
library(tidyr)
# 数据
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )
)
# 长格式转换并处理标签
data_long <- pivot_longer(
data,
cols = -Time,
names_to = c("Prefix", "Concentration"),
names_pattern = "HSP_([0-9.]+)ug/ml",
values_to = "Viability"
) %>%
mutate(HSP_Concentration = paste0(Prefix, "_", Concentration, " μg/ml"))
# 绘图
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +
geom_point(size = 3) +
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Cell Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +
scale_x_continuous(breaks = c(24, 48, 72))
# 加载必要的包
library(ggplot2)
library(tidyr) # 用于数据整理
# 假设你的数据如下（请替换为你的实际数据）
data <- data.frame(
Time = c(24, 48, 72),
`HSP_12.5ug/ml` = c(27.24, 18.99 , 12.22 ),   # 示例数据，12.5ug/ml 组的活力值
`HSP_25ug/ml` = c(24.77 , 14.98 , 6.68 ),      # 25ug/ml 组的活力值
`HSP_50ug/ml` = c(26.47 , 6.55 , 3.26 ),      # 50ug/ml 组的活力值
`HSP_100ug/ml` = c(47.82 , 16.30 , 5.38 )      # 100ug/ml 组的活力值
)
# 转换数据为长格式（ggplot2 需要）
data_long <- pivot_longer(data, cols = -Time, names_to = "HSP_Concentration", values_to = "Viability")
# 画折线图
ggplot(data_long, aes(x = Time, y = Viability, color = HSP_Concentration, group = HSP_Concentration)) +
geom_line(size = 1) +          # 画折线
geom_point(size = 3) +         # 添加数据点
labs(
title = "Cell Viability under Different HSP Concentrations",
x = "Time (Hours)",
y = "Cell Viability (%)",
color = "HSP Concentration"
) +
theme_minimal() +             # 简洁主题
scale_x_continuous(breaks = c(24, 48, 72)) + # 确保X轴显示所有时间点
# 自定义图例标签
scale_color_discrete(labels = c("12.5 μg/ml", "25 μg/ml", "50 μg/ml", "100 μg/ml"))
library(shiny); runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
gc()
runApp('appchange.R')
runApp('appchange.R')
gc()
library(shiny); runApp('appchange.R')
runApp('appchange.R')
gc()
runApp('appchange.R')
library(shiny); runApp('appchange.R')
